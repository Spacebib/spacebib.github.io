# TDD 的实践

## TDD 的原则

要实践 TDD，首先我们需要时刻谨记 TDD 的三条原则：

1. 在编写不能通过的单元测试前，不可编写生产代码
2. 只可编写刚好无法通过的单元测试
3. 只可编写刚好足以通过当前失败测试的生产代码

## 如何在实际工作中实践 TDD

首先 “红灯 -- 绿灯 -- 重构” 流程是 TDD 的基石：

1. 创建一个失败的测试
2. 编写代码让测试通过
3. 改进、重构代码

具体来说，用 TDD 的方式实现新需求大概可以分为下面几步：

1. 先分解任务，分离关注点。
2. 列 Example，用实例化需求，澄清需求细节。
3. 写测试，只关注需求，程序的输入输出，不关心中间过程。
4. 写实现，不考虑别的需求，用最简单的方式满足当前这个小需求即可。
5. 重构。
6. 写完，手动测试一下，基本没什么问题，有问题补个用例，修复。
7. 提交。

1-2 步是帮助自己明确需求，搞清楚逻辑以及其中的细节。既避免在开发中途不断与业务人员确认需求，也让我们做到心中有数。

第 3 步，实现测试需要注意测试代码需要写的足够简单。

其中 3-5 步是一起走的，实际开发中应该频繁地在这三步之前切换，小步快跑，注意节奏，不要过度在意某个需求的快速实现。

第 5 步重构后，根据需要也要对测试代码进行重构。测试代码在 TDD 中是非常重要的，我们依赖我们的测试代码甚至超过生产代码。我们需要认真对待测试代码，保证它足够简单清楚，保持 DRY。否则更改需求时可能测试代码会成为我们的负担。

第 6 步，在 TDD 开发模式下，适当手动测试也是必要的。
